{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "config": {
    "view": {"stroke": null},
    "axis": {
      "domain": false,
      "labelColor": "#444",
      "titleColor": "#444"
    },
   "legend": {
      "orient": "bottom",
      "titleFontSize": 15,
      "labelFontSize": 12,
      "symbolSize": 80,
      "symbolLimit": 20,
      "rowPadding": 8,
      "columnPadding": 15,
      "columns": 3,
      "direction": "horizontal",
      "labelLimit": 0,
      "titleLimit": 0
    }
  },
  "params": [
    {
      "name": "rate_type_filter",
      "value": null,
      "bind": {
        "input": "select",
        "options": [
          null,
          "Fixed Deposit Rate (1mo)",
          "Fixed Deposit Rate (3mo)",
          "Fixed Deposit Rate (6mo)",
          "Fixed Deposit Rate (9mo)",
          "Fixed Deposit Rate (12mo)",
          "Weighted Avg Fixed Deposit Rate (1mo)",
          "Weighted Avg Fixed Deposit Rate (3mo)",
          "Weighted Avg Fixed Deposit Rate (6mo)",
          "Weighted Avg Fixed Deposit Rate (9mo)",
          "Weighted Avg Fixed Deposit Rate (12mo)",
          "Savings Deposit Rate",
          "Weighted Avg Savings Deposit Rate",
          "Base Rate (BR)",
          "Weighted Avg BR",
          "Base Lending Rate (BLR)",
          "Weighted Avg BLR",
          "Avg Lending Rate (ALR) on Outstanding Loans",
          "Weighted ALR"
        ],
        "labels": [
          "All Types",
          "Fixed Deposit Rate (1mo)",
          "Fixed Deposit Rate (3mo)",
          "Fixed Deposit Rate (6mo)",
          "Fixed Deposit Rate (9mo)",
          "Fixed Deposit Rate (12mo)",
          "Weighted Avg Fixed Deposit Rate (1mo)",
          "Weighted Avg Fixed Deposit Rate (3mo)",
          "Weighted Avg Fixed Deposit Rate (6mo)",
          "Weighted Avg Fixed Deposit Rate (9mo)",
          "Weighted Avg Fixed Deposit Rate (12mo)",
          "Savings Deposit Rate",
          "Weighted Avg Savings Deposit Rate",
          "Base Rate (BR)",
          "Weighted Avg BR",
          "Base Lending Rate (BLR)",
          "Weighted Avg BLR",
          "Avg Lending Rate (ALR) on Outstanding Loans",
          "Weighted ALR"
        ],
        "name": "Select Rate Type"
      }
    }
  ],
  "vconcat": [
    {
      "title": {
        "text": "Monthly Interest Rates (Bank Negara Malaysia)",
        "fontSize": 24,
        "font": "Time New Roman",
        "fontWeight": "bold"
      },
      "width": 1150,
      "height": 450,
      "data": {
        "url": "https://raw.githubusercontent.com/k-cmy/FIT3179-DV2/main/Datasets/interest_rates.csv"
      },
      "transform": [
        {
          "lookup": "rate",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/k-cmy/FIT3179-DV2/main/Datasets/money_banking_lookup.csv"
            },
            "key": "variable",
            "fields": ["variable_en"]
          }
        },
        {
          "aggregate": [
            {"op": "mean", "field": "value", "as": "mean_value"}
          ],
          "groupby": ["date", "variable_en"]
        },
        {
          "filter": "rate_type_filter == null || datum.variable_en == rate_type_filter"
        }
      ],
      "encoding": {
        "x": {
          "field": "date",
          "type": "temporal",
          "title": "Date",
          "axis": {"format": "%Y-%m", "titleFontSize": 16}
        },
        "y": {
          "field": "mean_value",
          "type": "quantitative",
          "title": "Mean Interest Rate (%)",
          "axis": {"titleFontSize": 16}
        },
        "color": {
          "condition": {
            "param": "hover",
            "field": "variable_en",
            "type": "nominal",
            "title": "Interest Rate Type",
            "scale": {"scheme": "category20b"}
          },
          "value": "gray"
        },
        "opacity": {
          "condition": {
            "param": "hover",
            "value": 1
          },
          "value": 0.2
        },
        "tooltip": [
          {"field": "date", "type": "temporal", "title": "Date", "format": "%Y-%m"},
          {"field": "variable_en", "type": "nominal", "title": "Rate Type"},
          {"field": "mean_value", "type": "quantitative", "title": "Mean Interest Rate (%)", "format": ".2f"}
        ]
      },
      "layer": [
        {
          "params": [{
            "name": "hover",
            "select": {
              "type": "point",
              "fields": ["variable_en"],
              "on": "mouseover"
            }
          }],
          "mark": {
            "type": "circle",
            "size": 15
          }
        },
        {
          "mark": "line"
        },
        {
          "transform": [
            {"filter": "datum.variable_en == 'Base Lending Rate (BLR)' && year(datum.date) == 2020 && month(datum.date) == 2"}
          ],
          "mark": {
            "type": "text",
            "align": "left",
            "baseline": "middle",
            "dx": 15,
            "dy": 0,
            "fontSize": 15,
            "fontWeight":"bold"
          },
          "encoding": {
            "text": {"value": "COVID-19 impact: BLR drop"}
          }
        },
         {
          "transform": [
            {"filter": "datum.variable_en == 'Weighted Avg BR' && year(datum.date) == 2019 && month(datum.date) == 4"}
          ],
          "mark": {
            "type": "text",
            "align": "left",
            "baseline": "middle",
            "dx": -80,
            "dy": -25,
            "fontSize": 15,
            "fontWeight":"bold"
          },
          "encoding": {
            "text": {"value": "Weighted Avg BR peaks"}
          }
        },
        {
          "transform": [
            {"filter": "datum.variable_en == 'Avg Lending Rate (ALR) on Outstanding Loans' && year(datum.date) == 2020 && month(datum.date) == 2"}
          ],
          "mark": {
            "type": "text",
            "align": "left",
            "baseline": "middle",
            "dx": 15,
            "dy": 10,
            "fontSize": 15,
            "fontWeight":"bold"
          },
          "encoding": {
            "text": {"value": "COVID-19 impact: ALR drop"}
          }
        }
      ]  
    },
    {
      "title": {
        "text": "Yearly Interest Rates (Bank Negara Malaysia)",
        "fontSize": 24,
        "font": "Time New Roman",
        "fontWeight": "bold"
      },
      "width": 1150,
      "height": 450,
      "data": {
        "url": "https://raw.githubusercontent.com/k-cmy/FIT3179-DV2/main/Datasets/interest_rates_annual.csv"
      },
      "transform": [
        {
          "lookup": "rate",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/k-cmy/FIT3179-DV2/main/Datasets/money_banking_lookup.csv"
            },
            "key": "variable",
            "fields": ["variable_en"]
          }
        },
        {
          "aggregate": [
            {"op": "mean", "field": "value", "as": "mean_value"}
          ],
          "groupby": ["date", "variable_en"]
        },
        {
          "filter": "rate_type_filter == null || datum.variable_en == rate_type_filter"
        }
      ],
      "encoding": {
        "x": {
          "field": "date",
          "type": "temporal",
          "title": "Date",
          "axis": {"format": "%Y", "titleFontSize": 16}
        },
        "y": {
          "field": "mean_value",
          "type": "quantitative",
          "title": "Mean Interest Rate (%)",
          "axis": {"titleFontSize": 16}
        },
        "color": {
          "condition": {
            "param": "hover",
            "field": "variable_en",
            "type": "nominal",
            "title": "Interest Rate Type",
            "scale": {"scheme": "category20b"}
          },
          "value": "gray"
        },
        "opacity": {
          "condition": {
            "param": "hover",
            "value": 1
          },
          "value": 0.2
        },
        "tooltip": [
          {"field": "date", "type": "temporal", "title": "Date", "format": "%Y"},
          {"field": "variable_en", "type": "nominal", "title": "Rate Type"},
          {"field": "mean_value", "type": "quantitative", "title": "Mean Interest Rate (%)", "format": ".2f"}
        ]
      },
      "layer": [
        {
          "params": [{
            "name": "hover",
            "select": {
              "type": "point",
              "fields": ["variable_en"],
              "on": "mouseover"
            }
          }],
          "mark": {
            "type": "circle",
            "size": 50
          }
        },
        {
          "mark": "line"
        },
        {
          "transform": [
            {"filter": "datum.variable_en == 'Base Lending Rate (BLR)' && year(datum.date) == 2008"}
          ],
          "mark": {
            "type": "text",
            "align": "left",
            "baseline": "middle",
            "dx": 5,
            "dy": -10,
            "fontSize": 15,
            "fontWeight":"bold"
          },
          "encoding": {
            "text": {"value": "2008 Financial Crisis"}
          }
        },
        {
          "transform": [
            {"filter": "datum.variable_en == 'Avg Lending Rate (ALR) on Outstanding Loans' && year(datum.date) == 1998"}
          ],
          "mark": {
            "type": "text",
            "align": "left",
            "baseline": "middle",
            "dx": 5,
            "dy": -10,
            "fontSize": 15,
            "fontWeight":"bold"
          },
          "encoding": {
            "text": {"value": "1998 ALR Peaks"}
          }
        },
        {
          "transform": [
            {"filter": "datum.variable_en == 'Base Lending Rate (BLR)' && year(datum.date) == 1998"}
          ],
          "mark": {
            "type": "text",
            "align": "left",
            "baseline": "middle",
            "dx": -19,
            "dy": -15,
            "fontSize": 15,
            "fontWeight":"bold"
          },
          "encoding": {
            "text": {"value": "BLR peaks"}
          }
        }
      ]
    }
  ]
}